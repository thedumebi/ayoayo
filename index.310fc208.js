var e,t={},n={},r="object"==typeof Reflect?Reflect:null,i=r&&"function"==typeof r.apply?r.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};e=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}(n=s).once=function(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,o),r(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}v(e,t,o,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&v(e,"error",t,n)}(e,i,{once:!0})}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var l=10;function c(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function a(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function u(e,t,n,r){var i,o,s,l;if(c(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),s=o[t]),void 0===s)s=o[t]=n,++e._eventsCount;else if("function"==typeof s?s=o[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),(i=a(e))>0&&s.length>i&&!s.warned){s.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=s.length,l=u,console&&console.warn&&console.warn(l)}return e}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=d.bind(r);return i.listener=n,r.wrapFn=i,i}function p(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):y(i,i.length)}function h(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function y(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function v(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(o){r.once&&e.removeEventListener(t,i),n(o)}))}}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");l=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return a(this)},s.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,o=this._events;if(void 0!==o)r=r&&void 0===o.error;else if(!r)return!1;if(r){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var l=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw l.context=s,l}var c=o[e];if(void 0===c)return!1;if("function"==typeof c)i(c,this,t);else{var a=c.length,u=y(c,a);for(n=0;n<a;++n)i(u[n],this,t)}return!0},s.prototype.addListener=function(e,t){return u(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return u(this,e,t,!0)},s.prototype.once=function(e,t){return c(t),this.on(e,f(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return c(t),this.prependListener(e,f(this,e,t)),this},s.prototype.removeListener=function(e,t){var n,r,i,o,s;if(c(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},s.prototype.listeners=function(e){return p(this,e,!0)},s.prototype.rawListeners=function(e){return p(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},s.prototype.listenerCount=h,s.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]};var m={};m=function e(t,n,r,i){if(0===n||null!=t.winner)return[t.captured[0]-t.captured[1],r];if(i){let i,o=-1/0;return t.permissibleMoves.forEach((s=>{const l=t.clone();l.play(s);const[c,a]=e(l,n-1,r+s,!1);c>o&&(o=c,i=a)})),[o,i]}{let i,o=1/0;return t.permissibleMoves.forEach((s=>{const l=t.clone();l.play(s);const[c,a]=e(l,n-1,r+s,!0);c<o&&(o=c,i=a)})),[o,i]}};class E extends n.EventEmitter{static events={GAME_OVER:"game_over",DROP_SEED:"drop_seed",SWITCH_TURN:"switch_turn",MOVE_TO:"move_to",PICKUP_SEEDS:"pickup_seeds",CAPTURE:"capture"};constructor(){super(),this.board=[[4,4,4,4,4,4],[4,4,4,4,4,4]],this.captured=[0,0],this.nextPlayer=0,this.isGameOver=!1,this.winner=null,this.permissibleMoves=[0,1,2,3,4,5],this.TOTAL_NUM_SEEDS=48,this.NUM_CELLS_PER_ROW=6}play(e){if(!this.permissibleMoves.includes(e))throw new Error("Not permitted to play this cell");let t;[this.board,t]=this.#e(this.board,this.nextPlayer,e,((e,...t)=>this.emit(e,...t))),this.captured[0]+=t[0],this.captured[1]+=t[1],this.nextPlayer=E.togglePlayer(this.nextPlayer),this.emit(E.events.SWITCH_TURN,this.nextPlayer),this.permissibleMoves=this.#t(this.board,this.nextPlayer);const n=0===this.permissibleMoves.length||this.captured.some((e=>e>this.TOTAL_NUM_SEEDS/2));if(0===this.permissibleMoves.length){let e=0;this.board[this.nextPlayer]=this.board[this.nextPlayer].map(((t,n)=>(e+=t,this.emit(E.events.CAPTURE,this.nextPlayer,n,this.nextPlayer),0))),this.captured[this.nextPlayer]+=e}n&&(this.permissibleMoves=[],this.isGameOver=!0,this.winner=this.#n(this.captured),this.emit(E.events.GAME_OVER,this.winner))}#e(e,t,n,r=(()=>{})){const i=[0,0];let o=e[t][n];r(E.events.PICKUP_SEEDS,t,n),e[t][n]=0;let s=this.#r(t,n);r(E.events.MOVE_TO,[t,n],s);let[l,c]=s;for(;o>0;){if(e[l][c]++,o--,r(E.events.DROP_SEED,l,c),4===e[l][c]){const n=0===o?t:l;i[n]+=4,e[l][c]=0,r(E.events.CAPTURE,l,c,n)}0===o&&e[l][c]>1&&(o=e[l][c],e[l][c]=0,r(E.events.PICKUP_SEEDS,l,c)),s=this.#r(l,c),r(E.events.MOVE_TO,[l,c],s),[l,c]=s}return[e,i]}static togglePlayer(e){return(e+1)%2}#t(e,t){const n=E.togglePlayer(t),r=e[t].map(((e,t)=>t)).filter((n=>e[t][n]>0));return e[n].some((e=>e>0))?r:r.filter((r=>{const i=e.map((e=>e.slice())),[o]=this.#e(i,t,r);return o[n].some((e=>e>0))}))}#n(e){return e[0]===e[1]?-1:e[0]>e[1]?0:1}#r(e,t){return 0===e?0===t?[1,0]:[0,t-1]:t===this.NUM_CELLS_PER_ROW-1?[0,this.NUM_CELLS_PER_ROW-1]:[1,t+1]}clone(){const e=new E;return e.winner=this.winner,e.captured=this.captured.slice(),e.board=this.board.map((e=>e.slice())),e.permissibleMoves=this.permissibleMoves.slice(),e.nextPlayer=this.nextPlayer,e}static vsMinimax(e=5){const t=new E,n=t.play.bind(t);return t.play=function(...r){if(n(...r),null==t.winner){const[,r]=m(t,e,"",0===t.nextPlayer),i=Number(r[0]);n(i)}},t}}let g,_;t=E;let b=[];const S=document.querySelectorAll(".pit"),L=document.querySelector(".board"),P=document.querySelectorAll(".player"),w=document.querySelector(".modal-bg"),x=document.querySelector(".help-modal"),C=document.querySelector(".hand.sowing"),O=document.querySelectorAll(".turn-badge"),M=document.querySelector(".hand.capturing"),R=document.querySelectorAll(".winner-badge"),A=document.querySelector(".no-game-padding"),T=document.querySelector(".help-modal-close"),q=document.querySelector(".controls button.help"),U=document.querySelector(".controls button.ai"),N=document.querySelector(".controls button.pvp");function D(e,t){return document.querySelector(`.side-${e+1} .pit-${t+1}`)}function k(e,t){const n=D(e,t).getBoundingClientRect(),r=L.getBoundingClientRect();return[n.x-r.x,n.y-r.y]}function j(e){return e.parentElement.querySelector(".pit-summary")}function I(e,t){e.textContent=0===t?"":String(t)}function W(e){return document.querySelector(`.player-${e+1} .captured`)}function $(e){return e.querySelector(".pit-summary")}function V(){const e=M.querySelectorAll(".seed"),t=W("-"===M.style.top[0]?0:1);e.forEach((e=>{M.removeChild(e),t.appendChild(e)}));const n=$(t);I(n,Number(n.textContent)+e.length)}function F(e){const n=t.togglePlayer(e);O.item(e).style.display="inline-block",O.item(n).style.display="none"}const K={[t.events.PICKUP_SEEDS]:function(e,t){if(0===t){const[t,n]=e.args,[r,i]=k(t,n);C.style.left=`${r}px`,C.style.top=`${i}px`;const o=D(t,n);o.querySelectorAll(".seed").forEach((e=>{o.removeChild(e),C.appendChild(e)})),I(j(o),0)}},[t.events.MOVE_TO]:function(e,t){const[[n,r],[i,o]]=e.args,[s,l]=k(n,r),[c,a]=k(i,o),u=s+t*(c-s),d=l+t*(a-l);C.style.left=`${u}px`,C.style.top=`${d}px`,V()},[t.events.DROP_SEED]:function(e,t){if(0===t){const t=C.querySelector(".seed");C.removeChild(t);const[n,r]=e.args,i=D(n,r);i.appendChild(t);const o=j(i);I(o,Number(o.textContent)+1)}},[t.events.SWITCH_TURN]:function(e,t){if(0===t){const[t]=e.args;F(t)}},[t.events.CAPTURE]:function(e,t){0===t&&V();const[n,r,i]=e.args,o=D(n,r);o.querySelectorAll(".seed").forEach((e=>{o.removeChild(e),M.appendChild(e)}));const[s,l]=k(n,r),[c,a]=function(e){const t=W(e).getBoundingClientRect(),n=L.getBoundingClientRect();return[t.x-n.x,t.y-n.y]}(i),u=s+t*(c-s),d=l+t*(a-l);M.style.left=`${u}px`,M.style.top=`${d}px`,I(j(o),0)},[t.events.GAME_OVER]:function(e,t){if(0===t){V();const[t]=e.args;if(O.forEach((e=>{e.style.display="none"})),-1===t)return void R.forEach((e=>{e.textContent="Draw!",e.style.display="inline-block"}));const n=R.item(t);n.textContent="Winner!",n.style.display="inline-block"}}},G=200;function H(e){const t=e.parentElement.clientWidth,n=40*t/90,r=-20*t/90,i=Math.round(360*Math.random()),o=Math.round(Math.random()*n)+r,s=Math.round(Math.random()*n)+r;e.style.transform=`rotate(${i}deg) translate(${o}px, ${s}px)`}function B(e,t){e.querySelectorAll(".seed").forEach((t=>{e.removeChild(t)}));for(let n=0;n<t;n++){const t=document.createElement("div");t.classList.add("seed"),e.appendChild(t),H(t)}}function z(){const e=g.nextPlayer,n=t.togglePlayer(g.nextPlayer);g.board[n].forEach(((e,t)=>{D(n,t).classList.add("disabled")})),g.board[e].forEach(((t,n)=>{const r=D(e,n);g.permissibleMoves.includes(n)?r.classList.remove("disabled"):r.classList.add("disabled")}))}function J(e){return function(...t){b.push({type:e,args:t})}}const Q=J(t.events.PICKUP_SEEDS),X=J(t.events.MOVE_TO),Y=J(t.events.DROP_SEED),Z=J(t.events.SWITCH_TURN),ee=J(t.events.CAPTURE),te=J(t.events.GAME_OVER);function ne(e){var n;g.on(t.events.PICKUP_SEEDS,Q),g.on(t.events.MOVE_TO,X),g.on(t.events.DROP_SEED,Y),g.on(t.events.SWITCH_TURN,Z),g.on(t.events.CAPTURE,ee),g.on(t.events.GAME_OVER,te),P.forEach(((t,n)=>{if(t.style.display="block",1===n){t.querySelector(".player-name").textContent=e}})),A.style.display="none",(n=g).board.forEach(((e,t)=>{e.forEach(((e,n)=>{const r=D(t,n);B(r,e),I(j(r),e)}))})),n.captured.forEach(((e,t)=>{const n=W(t);B(n,e),I($(n),e)})),[C,M].forEach((e=>{e.querySelectorAll(".seed").forEach((t=>{e.removeChild(t)}))})),R.forEach((e=>{e.style.display="none"})),F(n.nextPlayer),z(),_=null,b=[]}function re(e){if(g&&!e.currentTarget.classList.contains("disabled")){const t=4,n=e.currentTarget.classList.toString().split(" ").find((e=>e.includes("pit-")))[t];g.play(n-1)}}U.addEventListener("click",(function(){g=t.vsMinimax(),ne("AI")})),N.addEventListener("click",(function(){g=new t,ne("Player 2")})),q.addEventListener("click",(()=>{w.style.display="block",w.style.opacity=1,x.style.display="flex",x.style.opacity=1})),T.addEventListener("click",(()=>{w.style.display="none",w.style.opacity=0,x.style.display="none",x.style.opacity=0})),w.addEventListener("click",(()=>{x.style.opacity=0,x.style.display="none",w.style.opacity=0,w.style.display="none"})),document.querySelectorAll(".side .pit").forEach((e=>{e.addEventListener("click",re)})),document.querySelectorAll(".seed").forEach((e=>{H(e)})),window.requestAnimationFrame((function e(t){if(!_){if(0===b.length)return void window.requestAnimationFrame(e);_=b.shift(),_.start=t}const n=(t-_.start)/G;if(n>1)return 0===b.length&&z(),_=null,void window.requestAnimationFrame(e);S.forEach((e=>{e.classList.add("disabled")})),(0,K[_.type])(_,n),window.requestAnimationFrame(e)}));
//# sourceMappingURL=index.310fc208.js.map
